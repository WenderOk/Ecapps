<!DOCTYPE html>
<html>
<head>
    <title>–°–ø–∏—Å–æ–∫ –±–∏–∑–Ω–µ—Å–æ–≤ - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list.css') }}">
</head>
<body>
    <div class="list-container">
        <div class="list-box">
            <h1 class="list-title">üìä –°–ø–∏—Å–æ–∫ –±–∏–∑–Ω–µ—Å–æ–≤</h1>
            
            <div class="header-info">
                –í—Å–µ–≥–æ –±–∏–∑–Ω–µ—Å–æ–≤: {{ businesses|length }}
            </div>

            <div class="nav-links">
                <a href="/admin/dashboard">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                <a href="/admin/business/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–∏–∑–Ω–µ—Å</a>
            </div>

            {% if businesses %}
                {% for business in businesses %}
                <div class="business-card">
                    <div class="business-header">
                        <div class="business-name">
                            üè¢ {{ business.company_name }}
                        </div>
                        <div class="discount-badge">
                            –°–∫–∏–¥–∫–∞
                        </div>
                    </div>

                    <div class="business-info">
                        <strong>–ê–¥—Ä–µ—Å:</strong>
                        <div class="business-info-content">{{ business.address }}</div>
                    </div>

                    <div class="business-info">
                        <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong>
                        <div class="business-info-content">{{ business.coordinates }}</div>
                    </div>

                    <div class="business-info">
                        <strong>–°–∫–∏–¥–∫–∞:</strong>
                        <div class="business-info-content">{{ business.discount_description }}</div>
                    </div>

                    {% if business.phone_number %}
                    <div class="business-info">
                        <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong>
                        <div class="business-info-content">{{ business.phone_number }}</div>
                    </div>
                    {% endif %}

                    {% if business.working_hours %}
                    <div class="business-info">
                        <strong>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</strong>
                        <div class="business-info-content">{{ business.working_hours }}</div>
                    </div>
                    {% endif %}

                    <div class="business-info">
                        <strong>–°—Ç–∞—Ç—É—Å:</strong>
                        <div class="business-info-content">
                            <span class="status-badge {{ 'status-active' if business.is_active else 'status-inactive' }}">
                                {{ '–ê–∫—Ç–∏–≤–µ–Ω' if business.is_active else '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω' }}
                            </span>
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn btn-danger" onclick="deleteBusiness({{ business.id }})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üè¢</div>
                    <h3>–ë–∏–∑–Ω–µ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∏–∑–Ω–µ—Å–æ–≤.</p>
                    <a href="/admin/business/add" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –±–∏–∑–Ω–µ—Å</a>
                </div>
            {% endif %}
        </div>
    </div>
    <script src="/js/admin.js"></script>
    <script>
        function deleteBusiness(businessId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –±–∏–∑–Ω–µ—Å?')) {
                fetch(`/api/business/${businessId}`, { 
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        alert('–ë–∏–∑–Ω–µ—Å —É–¥–∞–ª–µ–Ω');
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–∏–∑–Ω–µ—Å–∞');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–∏–∑–Ω–µ—Å–∞: ' + error.message);
                });
            }
    }
    </script>
</body>
</html>