<!DOCTYPE html>
<html>
<head>
    <title>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list.css') }}">
</head>
<body>
    <div class="list-container">
        <div class="list-box">
            <h1 class="list-title">üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
            
            <div class="header-info">
                –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ users|length }}
            </div>

            <div class="nav-links">
                <a href="/admin/dashboard">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                <a href="/admin/users/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
            </div>

            {% if users %}
                {% for user in users %}
                <div class="business-card">
                    <div class="business-header">
                        <div class="business-name">
                            üë§ {{ user.telegram_username or '–ë–µ–∑ username' }}
                        </div>
                        <div class="status-badge {{ 'status-active' if user.card_active else 'status-inactive' }}">
                            {{ '–ê–∫—Ç–∏–≤–Ω–∞' if user.card_active else '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞' }}
                        </div>
                    </div>

                    <div class="business-info">
                        <strong>ID:</strong>
                        <div class="business-info-content">{{ user.id }}</div>
                    </div>

                    <div class="business-info">
                        <strong>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã:</strong>
                        <div class="business-info-content">{{ user.card_number }}</div>
                    </div>

                    <div class="business-info">
                        <strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong>
                        <div class="business-info-content">{{ user.created_at }}</div>
                    </div>

                    <div class="business-info">
                        <strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</strong>
                        <div class="business-info-content">{{ user.last_login or '–ù–∏–∫–æ–≥–¥–∞' }}</div>
                    </div>

                    <div class="actions">
                        <button class="btn btn-danger" onclick="deleteUser({{ user.id }})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üë•</div>
                    <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
                    <a href="/admin/users/add" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
                </div>
            {% endif %}
        </div>
    </div>
    <script src="/js/admin.js"></script>
    <script>
       function deleteUser(userId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                fetch(`/api/users/${userId}`, { 
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω');
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + error.message);
                });
            }
    }
    </script>
</body>
</html>